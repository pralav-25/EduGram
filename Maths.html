<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maths Adventure</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body, html { width:100%; height:100%; font-family:'Segoe UI',sans-serif; overflow:hidden; }

section {
  display:none; flex-direction:column; align-items:center; justify-content:center;
  width:100%; height:100vh; background-size:cover; background-position:center;
  position:relative; text-align:center; padding:20px; color:#fff;
}
section.active { display:flex; }
section::before {
  content:''; position:absolute; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.45); backdrop-filter:blur(3px); z-index:0; pointer-events:none;
}

h1, h2 {
    position: relative;
    z-index: 1;
    text-shadow: 3px 3px 8px rgba(0,0,0,0.9);
    margin-bottom: 20px;
    background: rgba(0,0,0,0.4);
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 32px;
}
p {
    position: relative;
    z-index: 1;
    font-size: 24px;
    margin-bottom: 20px;
    line-height: 1.5;
    background: rgba(0,0,0,0.35);
    padding: 10px 16px;
    border-radius: 10px;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.8);
    max-width: 800px;
}

button {
    position: relative;
    z-index: 1;
    background: linear-gradient(135deg,#3498db,#2980b9);
    border: none;
    color: #fff;
    padding: 16px 34px;
    margin: 12px;
    border-radius: 16px;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    transition: all 0.3s ease;
}
button:hover { transform: scale(1.05); box-shadow: 0 10px 25px rgba(0,0,0,0.6); }

#map-panel .location {
  position:relative; z-index:1; background:rgba(255,255,255,0.2);
  padding:20px 36px; margin:14px; border-radius:14px; cursor:pointer;
  font-size:22px; transition:all 0.3s ease; box-shadow:0 4px 12px rgba(0,0,0,0.5);
  color:#fff; text-shadow:1px 1px 4px rgba(0,0,0,0.7);
}
#map-panel .location:hover { background:rgba(255,255,255,0.35); transform:scale(1.1); }

#quiz-options button { display:block; width:350px; margin:10px auto; }
#final-score { font-size:36px; font-weight:bold; z-index:1; margin-top:20px; }
#score-panel-buttons { margin-top:20px; }
</style>
</head>
<body>
<button class="exit-btn" style="
  position: fixed;
  top: 12px;
  right: 12px;
  background: #e53935;
  color: #fff;
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  z-index: 10;">
  Exit Game
</button>
<section id="start-screen" style="background-image: url('start-bg.jpg');" class="active">
  <h1>Maths Adventure</h1>
  <button onclick="startGame()">Start Journey</button>
</section>

<section id="map-panel" style="background-image: url('map-bg.jpg');">
  <h2>Explore Odisha</h2>
  <div class="location" onclick="startQuiz(0)">Cuttack Market</div>
  <div class="location" onclick="startQuiz(1)">Konark Sun Temple</div>
  <div class="location" onclick="startQuiz(2)">Puri Beach</div>
  <div class="location" onclick="startQuiz(3)">Chilika Lake</div>
  <div class="location" onclick="startQuiz(4)">Bhubaneswar Temple</div>
</section>

<section id="location-info-panel">
  <h2 id="location-title"></h2>
  <p id="location-info"></p>
  <button onclick="startLocationQuiz()">Start Quiz</button>
</section>

<section id="quiz-panel">
  <h2>Math Challenge</h2>
  <p id="quiz-question"></p>
  <div id="quiz-options"></div>
</section>

<section id="score-panel" style="background-image:url('score-bg.jpg');">
  <h2>Final Score</h2>
  <p id="final-score"></p>
  <div id="score-panel-buttons">
    <button onclick="restartGame()">Play Again</button>
    <button class="exit-btn">Exit Game</button>
  </div>
</section>

<audio id="click-sound" src="click.mp3"></audio>
<audio id="correct-sound" src="correct.mp3"></audio>
<audio id="wrong-sound" src="wrong.mp3"></audio>
<audio id="celebration-sound" src="celebration.mp3"></audio>

<script>
let currentQuizIndex=0, score=0, currentQuestions=[];
let currentBgImages=['cuttack.jpg','konark.jpg','puri.jpg','chilika.jpg','bhubaneswar.jpg'];

const startScreen=document.getElementById('start-screen');
const mapPanel=document.getElementById('map-panel');
const infoPanel=document.getElementById('location-info-panel');
const quizPanel=document.getElementById('quiz-panel');
const scorePanel=document.getElementById('score-panel');
const quizQuestion=document.getElementById('quiz-question');
const quizOptions=document.getElementById('quiz-options');
const finalScore=document.getElementById('final-score');

function playSound(id){ const el=document.getElementById(id); if(el) el.play(); }
function startGame(){ startScreen.classList.remove('active'); mapPanel.classList.add('active'); }

// --- STORY-GENERATION ENGINE ---

function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
function getRandomElement(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function createQuestion(questionText, correctAnswer, unit = '') {
    correctAnswer = parseFloat(correctAnswer.toFixed(2));
    const options = new Set([correctAnswer]);
    while (options.size < 3) {
        const offset = correctAnswer * (getRandomInt(10, 30) / 100);
        const wrongOption = (getRandomInt(0, 1) === 0) ? correctAnswer + offset : correctAnswer - offset;
        if (wrongOption > 0 && wrongOption.toFixed(2) !== correctAnswer.toFixed(2)) {
            options.add(parseFloat(wrongOption.toFixed(2)));
        }
    }
    
    const shuffledOptions = shuffleArray(Array.from(options));
    const answerIndex = shuffledOptions.indexOf(correctAnswer);

    return {
        q: questionText,
        options: shuffledOptions.map(opt => `${opt}${unit}`),
        answer: answerIndex
    };
}

// --- EXPANDED Thematic Word Banks & Question Templates ---
const themes = {
    "Cuttack Market": {
        items: ['silver filigree', 'a set of bangles', 'a bag of spices', 'a handmade textile', 'a box of sweets', 'fresh produce'],
        actions: ['sells', 'buys', 'trades', 'offers a discount on', 'calculates the tax for'],
        contexts: ['a busy stall', 'a quiet shop', 'a market corner', 'the main aisle', 'a wholesale depot']
    },
    "Konark Sun Temple": {
        items: ['stone carvings', 'entry tickets', 'souvenir statues', 'a historical book', 'a miniature chariot wheel', 'a tour guide map'],
        actions: ['calculates the price of', 'restores', 'measures', 'estimates the weight of', 'sells'],
        contexts: ['the main chariot wheel', 'the temple entrance', 'a restoration project', 'the souvenir shop', 'the Natya Mandir']
    },
    "Puri Beach": {
        items: ['a boat ride', 'a plate of seafood', 'a collection of seashells', 'a sandcastle', 'a deck chair rental', 'a coconut drink'],
        actions: ['travels', 'builds', 'sells', 'rents out', 'collects'],
        contexts: ['the shoreline', 'a beach shack', 'the calm sea', 'the golden sand', 'the bustling promenade']
    },
    "Chilika Lake": {
        items: ['migratory birds', 'Irrawaddy dolphins', 'a boat full of tourists', 'a fisherman\'s catch', 'bags of prawns', 'a binocular rental'],
        actions: ['counts', 'observes', 'transports', 'weighs', 'rents out'],
        contexts: ['a bird sanctuary', 'the middle of the lake', 'a fishing boat', 'a tourist ferry', 'a research station']
    },
    "Bhubaneswar Temple": {
        items: ['stone pillars', 'flower garlands', 'plates of offerings', 'ancient scriptures', 'oil lamps (diyas)', 'sacks of rice'],
        actions: ['decorates', 'counts', 'builds', 'arranges', 'donates'],
        contexts: ['the main courtyard', 'the inner sanctum', 'the temple kitchen', 'the boundary wall', 'a prayer hall']
    }
};

const questionTemplates = {
    algebra: (theme) => {
        const a = getRandomInt(2, 9);
        const x = getRandomInt(5, 20);
        const b = getRandomInt(10, 50);
        const result = a * x + b;
        const item = getRandomElement(theme.items);
        const templates = [
            `In ${getRandomElement(theme.contexts)}, the total cost of ${item} is found by the formula ${a}x + ${b}. If the final cost is ₹${result}, what is x?`,
            `To organize ${item}, a rule ${a}x + ${b} is used. If the result is ${result}, solve for x.`,
            `The number of ${item} is determined by the equation ${a}x + ${b} = ${result}. What is the value of x?`
        ];
        return createQuestion(getRandomElement(templates), x);
    },
    percentage: (theme) => {
        const price = getRandomInt(10, 80) * 10;
        const percent = getRandomInt(10, 40);
        const item = getRandomElement(theme.items);
        const templates = [
            {
                text: `The original price of ${item} is ₹${price}. What is the new price after a ${percent}% discount?`,
                answer: price * (1 - percent / 100)
            },
            {
                text: `A vendor ${getRandomElement(theme.actions)} ${item} for ₹${price} and makes a ${percent}% profit. What was the selling price?`,
                answer: price * (1 + percent / 100)
            },
            {
                text: `A tax of ${percent}% is applied to ${item} which costs ₹${price}. What is the total price including tax?`,
                answer: price * (1 + percent / 100)
            }
        ];
        const selected = getRandomElement(templates);
        return createQuestion(selected.text, selected.answer, ' INR');
    },
    geometry: (theme) => {
        const length = getRandomInt(10, 40);
        const width = getRandomInt(8, 30);
        const context = getRandomElement(theme.contexts);
        const templates = [
            {
                text: `A rectangular area representing ${context} measures ${length}m by ${width}m. What is its area?`,
                answer: length * width,
                unit: ' m²'
            },
            {
                text: `What is the perimeter of a rectangular section of ${context} with sides ${length}m and ${width}m?`,
                answer: 2 * (length + width),
                unit: ' m'
            },
            {
                text: `If ${context} is a rectangular plot of ${length}m x ${width}m, what is the length of its diagonal? (Hint: a² + b² = c²)`,
                answer: Math.sqrt(length*length + width*width),
                unit: ' m'
            }
        ];
        const selected = getRandomElement(templates);
        return createQuestion(selected.text, selected.answer, selected.unit);
    },
    ratio: (theme) => {
        const ratio1 = getRandomInt(2, 7);
        const ratio2 = getRandomInt(ratio1 + 1, 12);
        const item1 = getRandomElement(theme.items);
        let item2 = getRandomElement(theme.items);
        while (item1 === item2) { item2 = getRandomElement(theme.items); }
        const total = (ratio1 + ratio2) * getRandomInt(5, 15);
        const answer = (total / (ratio1 + ratio2)) * ratio1;
        const templates = [
             `In ${getRandomElement(theme.contexts)}, ${item1} and ${item2} are mixed in a ${ratio1}:${ratio2} ratio. If there are ${total} items in total, how many are ${item1}?`,
             `A collection contains ${item1} and ${item2} in a ratio of ${ratio1} to ${ratio2}. With a total of ${total} items, find the quantity of ${item1}.`
        ];
        return createQuestion(getRandomElement(templates), answer);
    }
};

function generateDynamicQuiz(locationName) {
    const theme = themes[locationName];
    const generatorKeys = Object.keys(questionTemplates);
    const shuffledKeys = shuffleArray(generatorKeys);
    
    const questions = [];
    for(let i = 0; i < 5; i++) {
        const key = shuffledKeys[i % shuffledKeys.length];
        questions.push(questionTemplates[key](theme));
    }
    return questions;
}

// --- END OF STORY-GENERATION ENGINE ---

const locationInfo = [
  { title: "Cuttack Market", info: "Cuttack’s famous market is known for silver filigree and vibrant stalls." },
  { title: "Konark Sun Temple", info: "A UNESCO World Heritage Site, Konark is known for its 24-wheel chariot of the Sun God." },
  { title: "Puri Beach", info: "Golden sands and calm waves make Puri Beach perfect for relaxation." },
  { title: "Chilika Lake", info: "Asia’s largest brackish water lagoon, home to dolphins and migratory birds." },
  { title: "Bhubaneswar Temple", info: "Bhubaneswar, the ‘Temple City of India’, is famed for ancient Kalinga architecture." }
];


let currentBgIndex=0;

function startQuiz(index){
  currentQuizIndex=0; score=0;
  const locationName = locationInfo[index].title;
  currentQuestions = generateDynamicQuiz(locationName); 
  
  currentBgIndex=index;
  document.getElementById('location-title').textContent = locationInfo[index].title;
  document.getElementById('location-info').textContent = locationInfo[index].info;
  infoPanel.style.backgroundImage=`url('${currentBgImages[index]}')`;
  mapPanel.classList.remove('active');
  infoPanel.classList.add('active');
}

function startLocationQuiz(){
  infoPanel.classList.remove('active');
  quizPanel.style.backgroundImage=`url('${currentBgImages[currentBgIndex]}')`;
  quizPanel.classList.add('active');
  showQuestion();
}

function showQuestion(){
  const q=currentQuestions[currentQuizIndex];
  quizQuestion.textContent=q.q;
  quizOptions.innerHTML='';
  q.options.forEach((opt,i)=>{
    const btn=document.createElement('button');
    btn.textContent=opt;
    btn.onclick=()=>checkAnswer(i,btn);
    quizOptions.appendChild(btn);
  });
}

function checkAnswer(selected, btn){
  const q=currentQuestions[currentQuizIndex];
  const correctIndex=q.answer;
  const buttons=quizOptions.querySelectorAll('button');
  buttons.forEach(b=>b.disabled=true);
  if(selected===correctIndex){
    btn.style.background='#2ecc71';
    score++; playSound('correct-sound');
  } else {
    btn.style.background='#e74c3c';
    buttons[correctIndex].style.background='#2ecc71';
    playSound('wrong-sound');
  }
  setTimeout(()=>{
    currentQuizIndex++;
    if(currentQuizIndex<currentQuestions.length){ showQuestion(); }
    else{
      quizPanel.classList.remove('active');
      scorePanel.classList.add('active');
      finalScore.textContent=`${score} / ${currentQuestions.length}`;
      playSound('celebration-sound');
    }
  },1000);
}

function restartGame(){
  scorePanel.classList.remove('active');
  startScreen.classList.add('active');
}

document.querySelectorAll('.exit-btn').forEach(button => {
  button.addEventListener('click', () => {
    window.location.href = 'studentend.html';
  });
});

</script>
</body>
</html>
